<!doctype html>
<html lang="zh-Hant">
  <head>
    <meta charset="utf-8" />
    <title>è‚ŒåŠ›è¨“ç·´å€’æ•¸è¨ˆæ™‚å™¨</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      * {
        box-sizing: border-box;
      }

      :root {
        --bg: #0f172a;
        --card-bg: #020617;
        --text-main: #e5e7eb;
        --text-sub: #9ca3af;
        --text-muted: #6b7280;
        --border-color: rgba(148, 163, 184, 0.3);
        --input-bg: #020617;
        --input-border: #4b5563;
        --button-primary-bg: #22c55e;
        --button-primary-text: #022c22;
        --button-secondary-bg: #111827;
        --button-secondary-border: #374151;
        --progress-bg: #1f2937;
        --shadow-main: 0 18px 45px rgba(0, 0, 0, 0.55);
      }

      :root[data-theme="light"] {
        --bg: #f3f4f6;
        --card-bg: #ffffff;
        --text-main: #111827;
        --text-sub: #4b5563;
        --text-muted: #6b7280;
        --border-color: rgba(148, 163, 184, 0.7);
        --input-bg: #ffffff;
        --input-border: #9ca3af;
        --button-primary-bg: #16a34a;
        --button-primary-text: #f9fafb;
        --button-secondary-bg: #e5e7eb;
        --button-secondary-border: #d1d5db;
        --progress-bg: #e5e7eb;
        --shadow-main: 0 12px 30px rgba(15, 23, 42, 0.15);
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        margin: 0;
        padding: 0;
        background: var(--bg);
        color: var(--text-main);
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
      }

      .container {
        max-width: 420px;
        width: 100%;
        padding: 18px 20px 26px;
        background: var(--card-bg);
        border-radius: 18px;
        box-shadow: var(--shadow-main);
        border: 1px solid var(--border-color);
      }

      .top-bar {
        display: flex;
        justify-content: flex-end;
        align-items: center;
        margin-bottom: 8px;
      }

      .top-bar-controls {
        display: flex;
        align-items: center;
        gap: 6px;
      }

      #lang-select {
        padding: 4px 10px;
        border-radius: 999px;
        border: 1px solid var(--input-border);
        background: var(--input-bg);
        color: var(--text-main);
        font-size: 12px;
      }

      #lang-select:focus {
        outline: none;
        border-color: #22c55e;
        box-shadow: 0 0 0 1px rgba(34, 197, 94, 0.5);
      }

      #theme-toggle {
        width: 32px;
        height: 32px;
        border-radius: 999px;
        border: 1px solid var(--input-border);
        background: var(--card-bg);
        color: var(--text-main);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 16px;
        cursor: pointer;
      }

      #theme-toggle:hover {
        opacity: 0.86;
      }

      h1 {
        font-size: 20px;
        margin: 0 0 8px;
        text-align: center;
      }

      .subtitle {
        font-size: 13px;
        text-align: center;
        color: var(--text-sub);
        margin-bottom: 18px;
      }

      .form-row {
        display: flex;
        gap: 10px;
        margin-bottom: 10px;
      }

      .field {
        flex: 1;
      }

      label {
        display: block;
        font-size: 12px;
        margin-bottom: 4px;
        color: var(--text-sub);
      }

      input[type="number"] {
        width: 100%;
        padding: 8px 10px;
        border-radius: 10px;
        border: 1px solid var(--input-border);
        background: var(--input-bg);
        color: var(--text-main);
        font-size: 14px;
      }

      input[type="number"]:focus {
        outline: none;
        border-color: #22c55e;
        box-shadow: 0 0 0 1px rgba(34, 197, 94, 0.5);
      }

      .timer-wrapper {
        margin: 18px auto 14px;
        display: flex;
        justify-content: center;
      }

      .progress-ring {
        transform: rotate(-90deg);
      }

      .progress-ring__background {
        fill: transparent;
        stroke: var(--progress-bg);
        stroke-width: 10;
      }

      .progress-ring__circle {
        fill: transparent;
        stroke: #22c55e;
        stroke-width: 10;
        stroke-linecap: round;
        transition: stroke-dashoffset 0.25s linear;
      }

      .timer-center {
        position: absolute;
        inset: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        pointer-events: none;
      }

      .timer-value {
        font-size: 32px;
        font-weight: 600;
      }

      .timer-phase {
        font-size: 13px;
        margin-top: 4px;
        color: var(--text-sub);
      }

      .timer-set {
        font-size: 12px;
        margin-top: 2px;
        color: var(--text-muted);
      }

      .timer-shell {
        position: relative;
        width: 220px;
        height: 220px;
      }

      .status-bar {
        display: flex;
        justify-content: space-between;
        font-size: 12px;
        color: var(--text-sub);
        margin-bottom: 10px;
      }

      .buttons {
        display: flex;
        gap: 10px;
        margin-top: 4px;
      }

      button {
        flex: 1;
        border-radius: 999px;
        border: none;
        padding: 10px 12px;
        font-size: 15px;
        font-weight: 500;
        cursor: pointer;
      }

      #start-btn {
        background: var(--button-primary-bg);
        color: var(--button-primary-text);
      }

      #start-btn:disabled {
        background: #14532d;
        cursor: not-allowed;
      }

      #stop-btn {
        background: var(--button-secondary-bg);
        color: var(--text-main);
        border: 1px solid var(--button-secondary-border);
      }

      #stop-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      .hint {
        margin-top: 10px;
        font-size: 11px;
        color: var(--text-muted);
      }

      .phase-work {
        color: #22c55e;
      }

      .phase-rest {
        color: #38bdf8;
      }

      .phase-done {
        color: #f97316;
      }

      @media (max-width: 480px) {
        .container {
          border-radius: 0;
          height: 100vh;
          max-width: 480px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="top-bar">
        <div class="top-bar-controls">
          <select id="lang-select" aria-label="Language">
            <option value="zh">ä¸­æ–‡</option>
            <option value="en">English</option>
          </select>
          <button
            id="theme-toggle"
            type="button"
            aria-label="Toggle theme"
            title="åˆ‡æ›ä¸»é¡Œ"
          >
            ğŸŒ™
          </button>
        </div>
      </div>

      <h1 data-i18n="title">è‚ŒåŠ›è¨“ç·´å€’æ•¸è¨ˆæ™‚å™¨</h1>
      <div class="subtitle" data-i18n="subtitle">
        è¨­å®šæ¯çµ„é‹å‹•ç§’æ•¸ã€ä¼‘æ¯ç§’æ•¸èˆ‡çµ„æ•¸ï¼ŒæŒ‰ã€Œé–‹å§‹ã€å°±èƒ½è‡ªå‹•è·‘å®Œæ•´å€‹å¾ªç’°ã€‚
      </div>

      <div class="form-row">
        <div class="field">
          <label for="work-seconds" data-i18n="label_work">é‹å‹•ç§’æ•¸ (ç§’)</label>
          <input id="work-seconds" type="number" min="5" max="3600" value="30" />
        </div>
        <div class="field">
          <label for="rest-seconds" data-i18n="label_rest">ä¼‘æ¯ç§’æ•¸ (ç§’)</label>
          <input id="rest-seconds" type="number" min="0" max="3600" value="15" />
        </div>
      </div>

      <div class="form-row">
        <div class="field">
          <label for="sets-count" data-i18n="label_sets">çµ„æ•¸</label>
          <input id="sets-count" type="number" min="1" max="99" value="5" />
        </div>
      </div>

      <div class="status-bar">
        <div id="status-label">ç‹€æ…‹ï¼šå¾…æ©Ÿä¸­</div>
        <div id="total-label">ç¸½æ™‚é–“ï¼šç´„ 3 åˆ†é˜</div>
      </div>

      <div class="timer-wrapper">
        <div class="timer-shell">
          <svg class="progress-ring" width="220" height="220">
            <circle
              class="progress-ring__background"
              cx="110" cy="110" r="95"
            ></circle>
            <circle
              id="progress-ring"
              class="progress-ring__circle"
              cx="110" cy="110" r="95"
            ></circle>
          </svg>
          <div class="timer-center">
            <div id="timer-value" class="timer-value">00:00</div>
            <div id="timer-phase" class="timer-phase phase-done">å¾…æ©Ÿä¸­</div>
            <div id="timer-set" class="timer-set">çµ„æ•¸ï¼š0 / 0</div>
          </div>
        </div>
      </div>

      <div class="buttons">
        <button id="start-btn" data-i18n="btn_start">é–‹å§‹</button>
        <button id="stop-btn" disabled data-i18n="btn_stop">çµæŸ</button>
      </div>

      <div class="hint">
        <span data-i18n="hint_line1">ãƒ»æ™‚é–“åˆ°å‰ 5 ç§’æœƒæ¯ç§’æç¤ºä¸€è²ã€‚</span><br />
        <span data-i18n="hint_line2">ãƒ»æŒ‰ã€ŒçµæŸã€å¯éš¨æ™‚ä¸­æ­¢ä¸¦é‡ç½®è¨ˆæ™‚ã€‚</span><br />
        <span data-i18n="hint_line3">
          ãƒ»æ­¤å·¥å…·ç‚ºå–®äººè¨“ç·´è¨­è¨ˆï¼Œè‹¥è¦å¤šäººå…±ç”¨å¯å†æ‹†æˆä¸åŒç€è¦½å™¨åˆ†é ã€‚
        </span>
      </div>
    </div>

    <script>
      // ----- å¤šèªç³»å­—ä¸²å®šç¾© -----
      const i18n = {
        zh: {
          title: "è‚ŒåŠ›è¨“ç·´å€’æ•¸è¨ˆæ™‚å™¨",
          subtitle:
            "è¨­å®šæ¯çµ„é‹å‹•ç§’æ•¸ã€ä¼‘æ¯ç§’æ•¸èˆ‡çµ„æ•¸ï¼ŒæŒ‰ã€Œé–‹å§‹ã€å°±èƒ½è‡ªå‹•è·‘å®Œæ•´å€‹å¾ªç’°ã€‚",
          label_work: "é‹å‹•ç§’æ•¸ (ç§’)",
          label_rest: "ä¼‘æ¯ç§’æ•¸ (ç§’)",
          label_sets: "çµ„æ•¸",
          hint_line1: "ãƒ»æ™‚é–“åˆ°å‰ 5 ç§’æœƒæ¯ç§’æç¤ºä¸€è²ã€‚",
          hint_line2: "ãƒ»æŒ‰ã€ŒçµæŸã€å¯éš¨æ™‚ä¸­æ­¢ä¸¦é‡ç½®è¨ˆæ™‚ã€‚",
          hint_line3:
            "ãƒ»æ­¤å·¥å…·ç‚ºå–®äººè¨“ç·´è¨­è¨ˆï¼Œè‹¥è¦å¤šäººå…±ç”¨å¯å†æ‹†æˆä¸åŒç€è¦½å™¨åˆ†é ã€‚",
          btn_start: "é–‹å§‹",
          btn_stop: "çµæŸ",
          phase_idle: "å¾…æ©Ÿä¸­",
          phase_work: "é‹å‹•",
          phase_rest: "ä¼‘æ¯",
          phase_done: "å…¨éƒ¨å®Œæˆï¼è¾›è‹¦äº†",
          sets_info: "çµ„æ•¸ï¼š{current} / {total}",
          status_idle: "ç‹€æ…‹ï¼šå¾…æ©Ÿä¸­",
          status_work: "ç‹€æ…‹ï¼šç¬¬ {set} çµ„é‹å‹•ä¸­",
          status_rest: "ç‹€æ…‹ï¼šç¬¬ {set} çµ„ä¼‘æ¯ä¸­",
          status_done: "ç‹€æ…‹ï¼šå®Œæˆ",
          total_time_zero: "ç¸½æ™‚é–“ï¼šç´„ 0 ç§’",
          total_time_seconds: "ç¸½æ™‚é–“ï¼šç´„ {seconds} ç§’",
          total_time_minutes: "ç¸½æ™‚é–“ï¼šç´„ {minutes} åˆ†",
          total_time_minutes_seconds: "ç¸½æ™‚é–“ï¼šç´„ {minutes} åˆ† {seconds} ç§’",
          theme_tooltip_dark: "åˆ‡æ›ç‚ºæ·ºè‰²ä¸»é¡Œ",
          theme_tooltip_light: "åˆ‡æ›ç‚ºæ·±è‰²ä¸»é¡Œ",
          lang_label: "èªè¨€",
        },
        en: {
          title: "Workout Timer",
          subtitle:
            "Set work seconds, rest seconds and number of sets, then press â€œStartâ€ to run the whole cycle.",
          label_work: "Work seconds (sec)",
          label_rest: "Rest seconds (sec)",
          label_sets: "Sets",
          hint_line1:
            "ãƒ»A short beep will play in each of the last 5 seconds.",
          hint_line2:
            "ãƒ»Press â€œStopâ€ to cancel and reset the timer at any time.",
          hint_line3:
            "ãƒ»Designed for single-person training; open multiple tabs for multiple users.",
          btn_start: "Start",
          btn_stop: "Stop",
          phase_idle: "Idle",
          phase_work: "Work",
          phase_rest: "Rest",
          phase_done: "All sets completed! Good job!",
          sets_info: "Sets: {current} / {total}",
          status_idle: "Status: Idle",
          status_work: "Status: Working â€“ Set {set}",
          status_rest: "Status: Resting â€“ Set {set}",
          status_done: "Status: Done",
          total_time_zero: "Total time: about 0 seconds",
          total_time_seconds: "Total time: about {seconds} seconds",
          total_time_minutes: "Total time: about {minutes} minutes",
          total_time_minutes_seconds:
            "Total time: about {minutes} min {seconds} sec",
          theme_tooltip_dark: "Switch to light theme",
          theme_tooltip_light: "Switch to dark theme",
          lang_label: "Language",
        },
      };

      let currentLang = localStorage.getItem("lang") || "zh";
      let currentTheme = localStorage.getItem("theme") || "dark";

      function t(key, vars) {
        const dict = i18n[currentLang] || i18n["zh"];
        let str = dict[key] || key;
        if (vars) {
          for (const [k, v] of Object.entries(vars)) {
            str = str.replace(`{${k}}`, v);
          }
        }
        return str;
      }

      const progressCircle = document.getElementById("progress-ring");
      const RADIUS = 95;
      const CIRCUMFERENCE = 2 * Math.PI * RADIUS;
      progressCircle.style.strokeDasharray =
        CIRCUMFERENCE + " " + CIRCUMFERENCE;
      progressCircle.style.strokeDashoffset = 0;

      const timerValueEl = document.getElementById("timer-value");
      const timerPhaseEl = document.getElementById("timer-phase");
      const timerSetEl = document.getElementById("timer-set");
      const statusLabelEl = document.getElementById("status-label");
      const totalLabelEl = document.getElementById("total-label");

      const workInput = document.getElementById("work-seconds");
      const restInput = document.getElementById("rest-seconds");
      const setsInput = document.getElementById("sets-count");
      const startBtn = document.getElementById("start-btn");
      const stopBtn = document.getElementById("stop-btn");
      const langSelectEl = document.getElementById("lang-select");
      const themeToggleBtn = document.getElementById("theme-toggle");
      const rootEl = document.documentElement;

      langSelectEl.value = currentLang;

      let timerId = null;
      let phase = "idle"; // idle | work | rest | done
      let currentSet = 0;
      let remainingSec = 0;
      let phaseTotalSec = 0;
      let globalWorkSec = 0;
      let globalRestSec = 0;
      let globalSets = 0;

      function setProgress(percent) {
        const offset = CIRCUMFERENCE - percent * CIRCUMFERENCE;
        progressCircle.style.strokeDashoffset = offset;
      }

      function formatTime(sec) {
        const m = Math.floor(sec / 60);
        const s = sec % 60;
        const mm = String(m).padStart(2, "0");
        const ss = String(s).padStart(2, "0");
        return mm + ":" + ss;
      }

      function updateTotalLabel() {
        const w = parseInt(workInput.value, 10) || 0;
        const r = parseInt(restInput.value, 10) || 0;
        const n = parseInt(setsInput.value, 10) || 0;
        let total = n * w + (n - 1) * r; // æœ€å¾Œä¸€çµ„é€šå¸¸ä¸ä¼‘æ¯
        if (total < 0 || !isFinite(total)) total = 0;

        const minutes = Math.floor(total / 60);
        const seconds = total % 60;

        let text;
        if (total === 0) {
          text = t("total_time_zero");
        } else if (minutes === 0) {
          text = t("total_time_seconds", { seconds });
        } else if (seconds === 0) {
          text = t("total_time_minutes", { minutes });
        } else {
          text = t("total_time_minutes_seconds", { minutes, seconds });
        }
        totalLabelEl.textContent = text;
      }

      workInput.addEventListener("input", updateTotalLabel);
      restInput.addEventListener("input", updateTotalLabel);
      setsInput.addEventListener("input", updateTotalLabel);

      function resetState() {
        if (timerId) {
          clearInterval(timerId);
          timerId = null;
        }
        phase = "idle";
        currentSet = 0;
        remainingSec = 0;
        phaseTotalSec = 0;
        setProgress(0);
        timerValueEl.textContent = "00:00";
        timerPhaseEl.textContent = t("phase_idle");
        timerPhaseEl.className = "timer-phase phase-done";
        timerSetEl.textContent = t("sets_info", { current: 0, total: 0 });
        statusLabelEl.textContent = t("status_idle");
        startBtn.disabled = false;
        stopBtn.disabled = true;
      }

      // Web Audio API å—¶è²
      function playBeep() {
        try {
          const ctx = new (window.AudioContext || window.webkitAudioContext)();
          const osc = ctx.createOscillator();
          const gainNode = ctx.createGain();
          osc.type = "sine";
          osc.frequency.value = 1200;
          gainNode.gain.setValueAtTime(0.001, ctx.currentTime);
          gainNode.gain.exponentialRampToValueAtTime(
            0.2,
            ctx.currentTime + 0.01
          );
          gainNode.gain.exponentialRampToValueAtTime(
            0.0001,
            ctx.currentTime + 0.18
          );
          osc.connect(gainNode);
          gainNode.connect(ctx.destination);
          osc.start();
          osc.stop(ctx.currentTime + 0.2);
        } catch (e) {
          // å¤±æ•—å°±éœéŸ³ç•¥é
        }
      }

      function nextPhase() {
        if (phase === "work") {
          if (globalRestSec > 0) {
            // é‹å‹• -> ä¼‘æ¯
            phase = "rest";
            remainingSec = globalRestSec;
            phaseTotalSec = globalRestSec;
            timerPhaseEl.textContent = t("phase_rest");
            timerPhaseEl.className = "timer-phase phase-rest";
            statusLabelEl.textContent = t("status_rest", {
              set: currentSet,
            });
            setProgress(1);
            return;
          } else {
            // ä¸ä¼‘æ¯ -> çœ‹æ˜¯å¦é€²ä¸‹ä¸€çµ„
            if (currentSet < globalSets) {
              currentSet++;
              phase = "work";
              remainingSec = globalWorkSec;
              phaseTotalSec = globalWorkSec;
              timerPhaseEl.textContent = t("phase_work");
              timerPhaseEl.className = "timer-phase phase-work";
              statusLabelEl.textContent = t("status_work", {
                set: currentSet,
              });
              timerSetEl.textContent = t("sets_info", {
                current: currentSet,
                total: globalSets,
              });
              setProgress(1);
              return;
            } else {
              // å…¨éƒ¨å®Œæˆ
              phase = "done";
              remainingSec = 0;
              phaseTotalSec = 0;
              timerValueEl.textContent = "å®Œæˆ";
              timerPhaseEl.textContent = t("phase_done");
              timerPhaseEl.className = "timer-phase phase-done";
              statusLabelEl.textContent = t("status_done");
              timerSetEl.textContent = t("sets_info", {
                current: globalSets,
                total: globalSets,
              });
              setProgress(0);
              clearInterval(timerId);
              timerId = null;
              startBtn.disabled = false;
              stopBtn.disabled = true;
              playBeep();
              playBeep();
              return;
            }
          }
        } else if (phase === "rest") {
          // ä¼‘æ¯ -> ä¸‹ä¸€çµ„é‹å‹•
          if (currentSet < globalSets) {
            currentSet++;
            phase = "work";
            remainingSec = globalWorkSec;
            phaseTotalSec = globalWorkSec;
            timerPhaseEl.textContent = t("phase_work");
            timerPhaseEl.className = "timer-phase phase-work";
            statusLabelEl.textContent = t("status_work", {
              set: currentSet,
            });
            timerSetEl.textContent = t("sets_info", {
              current: currentSet,
              total: globalSets,
            });
            setProgress(1);
            return;
          } else {
            // ä¿éšªåˆ†æ”¯
            phase = "done";
            remainingSec = 0;
            phaseTotalSec = 0;
            timerValueEl.textContent = "å®Œæˆ";
            timerPhaseEl.textContent = t("phase_done");
            timerPhaseEl.className = "timer-phase phase-done";
            statusLabelEl.textContent = t("status_done");
            timerSetEl.textContent = t("sets_info", {
              current: globalSets,
              total: globalSets,
            });
            setProgress(0);
            clearInterval(timerId);
            timerId = null;
            startBtn.disabled = false;
            stopBtn.disabled = true;
            playBeep();
            playBeep();
            return;
          }
        }
      }

      function tick() {
        if (remainingSec <= 0) {
          nextPhase();
          return;
        }

        remainingSec -= 1;

        timerValueEl.textContent = formatTime(remainingSec);
        if (phaseTotalSec > 0) {
          setProgress(remainingSec / phaseTotalSec);
        }

        if (remainingSec > 0 && remainingSec <= 5) {
          playBeep();
        }

        if (remainingSec <= 0) {
          nextPhase();
        }
      }

      function applyTranslations() {
        document.querySelectorAll("[data-i18n]").forEach((el) => {
          const key = el.getAttribute("data-i18n");
          el.textContent = t(key);
        });

        // ç‹€æ…‹èˆ‡çµ„æ•¸åœ¨ resetState / åŸ·è¡Œä¸­æœƒå†ç”¨ t() æ›´æ–°
        updateTotalLabel();

        // æ§åˆ¶å…ƒä»¶ tooltip
        langSelectEl.title = t("lang_label");
        themeToggleBtn.title =
          currentTheme === "dark"
            ? t("theme_tooltip_dark")
            : t("theme_tooltip_light");
      }

      function applyTheme() {
        rootEl.setAttribute("data-theme", currentTheme);
        themeToggleBtn.textContent = currentTheme === "dark" ? "ğŸŒ™" : "â˜€ï¸";
        themeToggleBtn.title =
          currentTheme === "dark"
            ? t("theme_tooltip_dark")
            : t("theme_tooltip_light");
      }

      startBtn.addEventListener("click", () => {
        if (timerId) return;

        const w = parseInt(workInput.value, 10);
        const r = parseInt(restInput.value, 10);
        const n = parseInt(setsInput.value, 10);

        if (!Number.isFinite(w) || w <= 0) {
          alert(currentLang === "zh"
            ? "è«‹è¼¸å…¥å¤§æ–¼ 0 çš„é‹å‹•ç§’æ•¸"
            : "Please enter a work duration greater than 0 seconds");
          return;
        }
        if (!Number.isFinite(r) || r < 0) {
          alert(currentLang === "zh"
            ? "ä¼‘æ¯ç§’æ•¸ä¸å¯ç‚ºè² æ•¸"
            : "Rest duration cannot be negative");
          return;
        }
        if (!Number.isFinite(n) || n <= 0) {
          alert(currentLang === "zh"
            ? "è«‹è¼¸å…¥å¤§æ–¼ 0 çš„çµ„æ•¸"
            : "Please enter a number of sets greater than 0");
          return;
        }

        globalWorkSec = w;
        globalRestSec = r;
        globalSets = n;

        phase = "work";
        currentSet = 1;
        remainingSec = globalWorkSec;
        phaseTotalSec = globalWorkSec;
        timerPhaseEl.textContent = t("phase_work");
        timerPhaseEl.className = "timer-phase phase-work";
        timerSetEl.textContent = t("sets_info", {
          current: currentSet,
          total: globalSets,
        });
        statusLabelEl.textContent = t("status_work", {
          set: currentSet,
        });
        timerValueEl.textContent = formatTime(remainingSec);
        setProgress(1);

        startBtn.disabled = true;
        stopBtn.disabled = false;

        if (timerId) clearInterval(timerId);
        timerId = setInterval(tick, 1000);
      });

      stopBtn.addEventListener("click", () => {
        resetState();
      });

      langSelectEl.addEventListener("change", () => {
        currentLang = langSelectEl.value;
        localStorage.setItem("lang", currentLang);
        applyTranslations();
        resetState(); // åˆ‡æ›èªè¨€æ™‚é †ä¾¿é‡ç½®ç‹€æ…‹
      });

      themeToggleBtn.addEventListener("click", () => {
        currentTheme = currentTheme === "dark" ? "light" : "dark";
        localStorage.setItem("theme", currentTheme);
        applyTheme();
      });

      // åˆå§‹åŒ–
      applyTheme();
      applyTranslations();
      updateTotalLabel();
      resetState();
    </script>
  </body>
</html>
